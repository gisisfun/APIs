<!DOCTYPE html>
<html>
<style>
  h1 {font-family:arial, sanserif;}
  h2 {font-family:arial, sanserif;}
  body {font-family:arial, sanserif;}
  table {
    font-family: arial, sans-serif;
    border-collapse:collapse;
    width: 100%;
  }
  td, th {
    border: 1px solid #dddddd;
  }
</style>
<body>

<h2>ABS SDMX-JSON Query</h2>
<FORM Name="theForm">
SA2 Maincode 2016: <INPUT Type=Text Name="fname" value="101021008">
<INPUT Type=Button Value="Action"  onClick='loadDoc(theForm.fname.value)'>
<table>
  <tr><th>SA2 Maincode 2016</th><th>SA2 Name 2016</th><th>Population</th></tr>
  <tr><td id="demo00"></td><td id="demo01"></td><td id="demo02"></td></tr>
  <tr><td id="demo10"></td><td id="demo11"></td><td id="demo12"></td></tr>
  <tr><td id="demo20"></td><td id="demo21"></td><td id="demo22"></td></tr>
</table>
<p id="demo0"></p>

<script src ="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
  function errormsg() {
    document.getElementById("demo0").innerHTML = "Unknown Region Code";
    document.getElementById("demo00").innerHTML = "";
    document.getElementById("demo01").innerHTML = "";
    document.getElementById("demo02").innerHTML = "";  
    document.getElementById("demo10").innerHTML = "";
    document.getElementById("demo11").innerHTML = "";
    document.getElementById("demo12").innerHTML = "";  
    document.getElementById("demo20").innerHTML = "";
    document.getElementById("demo21").innerHTML = "";
    document.getElementById("demo22").innerHTML = "";  
  }
  
function displaydata(jsontext,testvar)
 {
    if (testvar.length==0) {
      let newjsontext = jsontext.replace("0:0:0:0:0:0", "persons0").replace( "0:0:0:0:1:0", "persons1").replace( "0:0:0:0:2:0", "persons2");
      let obj = JSON.parse(newjsontext);
      let data0 = "";
      let data00 = obj.structure.dimensions.observation[4].values[0].id;
      let data01 = obj.structure.dimensions.observation[4].values[0].name;
      let data02 = obj.dataSets[0].observations.persons0[0];
      let data10 = obj.structure.dimensions.observation[4].values[1].id;
      let data11 = obj.structure.dimensions.observation[4].values[1].name;
      let data12 = obj.dataSets[0].observations.persons1[0];
      let data20 = obj.structure.dimensions.observation[4].values[2].id;
      let data21 = obj.structure.dimensions.observation[4].values[2].name;
      let data22 = obj.dataSets[0].observations.persons2[0];
      csvlist = "SA2 Maincode 2016,SA2 Name 2016,Persons<br>" + data00 + "," + data01 +"," + data02 + "<br>" + data10 + "," +data11 + "," + data12 + "<br>" + data20 +"," + data21 + "," + data22 + "<br>"
     
      document.getElementById("demo0").innerHTML = csvlist;
      document.getElementById("demo00").innerHTML = data00;
      document.getElementById("demo01").innerHTML = data01;
      document.getElementById("demo02").innerHTML = data02;
      document.getElementById("demo10").innerHTML = data10;
      document.getElementById("demo11").innerHTML = data11;
      document.getElementById("demo12").innerHTML = data12;
      document.getElementById("demo20").innerHTML = data20;
      document.getElementById("demo21").innerHTML = data21;
      document.getElementById("demo22").innerHTML = data22;
    }
   else
    {
      let newjsontext = jsontext.replace("0:0:0:0:0:0", "persons0");
      let obj = JSON.parse(newjsontext);
      let data0 = "";
      let data00 = obj.structure.dimensions.observation[4].values[0].id;
      let data01 = obj.structure.dimensions.observation[4].values[0].name;
      let data02 = obj.dataSets[0].observations.persons0[0];
      csvlist = "SA2 Maincode 2016,SA2 Name 2016,Persons<br>" + data00 + "," + data01 +"," + data02 + "<br>"
      document.getElementById("demo0").innerHTML = csvlist;
      document.getElementById("demo00").innerHTML = data00;
      document.getElementById("demo01").innerHTML = data01;
      document.getElementById("demo02").innerHTML = data02;
   }
}

  function loadDoc(fname) {
  
    let testvar = fname.trim();
    url = "http://stat.data.abs.gov.au/sdmx-json/data/ABS_C16_T01_SA/1+3+2.TT.1.SA2."+testvar+"/all?detail=Full&dimensionAtObservation=AllDimensions&startPeriod=2016&endPeriod=2016"
    let settings = { 
      "async": true, 
      "crossDomain": true,
      "url": url, 
      "method": "GET", 
      "headers": { 
       } 
    } 
  $.ajax(settings).done(function (response) { 
    console.log(response); 
    let textResponse= JSON.stringify(response);
    displaydata(textResponse,testvar);
    //return textResponse;
  }); 

  $.ajax(settings).error(function () {
  errormsg();
  });
  
}
</script>
</body>
</html>
